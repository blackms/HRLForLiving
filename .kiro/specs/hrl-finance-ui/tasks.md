# Implementation Plan - HRL Finance UI

- [x] 1. Set up project structure and dependencies
  - Create backend directory with FastAPI project structure
  - Create frontend directory with React + TypeScript + Vite setup
  - Set up requirements.txt with FastAPI, uvicorn, python-socketio, pydantic dependencies
  - Set up package.json with React, TypeScript, Tailwind CSS, Recharts, Axios, Socket.IO client
  - Create .gitignore files for both backend and frontend
  - _Requirements: 9.1, 9.2, 9.3_

- [x] 2. Implement backend API foundation
  - [x] 2.1 Create FastAPI application entry point
    - Implement main.py with FastAPI app initialization
    - Configure CORS middleware for frontend communication
    - Set up static file serving for frontend build
    - Add health check endpoint
    - _Requirements: 9.1, 9.5, 9.8_
  
  - [x] 2.2 Implement Pydantic models for requests and responses
    - ✅ Created EnvironmentConfig, TrainingConfig, RewardConfig, ScenarioConfig models
    - ✅ Created TrainingRequest, SimulationRequest, ReportRequest models
    - ✅ Created TrainingProgress, TrainingStatus, EpisodeResult, SimulationResults models
    - ✅ Created ScenarioSummary, ModelSummary, list response models
    - ✅ Created ReportResponse, HealthCheckResponse, ErrorResponse models
    - ✅ Added comprehensive validation rules with Field constraints
    - ✅ Implemented proper model configuration (protected_namespaces, populate_by_name)
    - _Requirements: 2.2, 2.3, 3.1, 4.1, 9.5_
  
  - [x] 2.3 Implement file management utilities ⭐ **COMPLETED**
    - ✅ Created file_manager.py with comprehensive file operations (568 lines)
    - ✅ Implemented YAML config read/write/delete/list functions with auto-extension handling
    - ✅ Implemented PyTorch model save/load/delete/list functions with metadata support
    - ✅ Implemented JSON results save/read/list functions with subdirectory support
    - ✅ Added filename sanitization to prevent path traversal attacks (regex-based)
    - ✅ Added path validation to ensure operations stay within allowed directories
    - ✅ Implemented ensure_directories() and get_file_size_mb() utility functions
    - ✅ Added comprehensive error handling with descriptive messages
    - ✅ Updated FILE_MANAGER_README.md with detailed documentation and examples
    - ✅ All functions include proper type hints and docstrings
    - ✅ Security features: sanitization, validation, safe YAML/JSON parsing
    - _Requirements: 10.1, 10.2, 10.3, 10.4_

- [x] 3. Implement Scenarios API ⭐ **COMPLETED**
  - [x] 3.1 Create scenarios service layer
    - ✅ Implemented scenario_service.py with comprehensive business logic (280 lines)
    - ✅ Added create_scenario function with validation and YAML storage
    - ✅ Added get_scenario function that loads, parses, and validates YAML
    - ✅ Added list_scenarios function that scans configs directory with metrics
    - ✅ Added update_scenario function with rename support
    - ✅ Added delete_scenario function
    - ✅ Added get_templates function with 5 preset profiles (conservative, balanced, aggressive, young_professional, young_couple)
    - ✅ Integrated with file_manager utilities for secure file operations
    - ✅ Proper error handling with descriptive messages
    - ✅ Exported via backend/services/__init__.py
    - _Requirements: 2.1, 2.2, 2.3, 2.6, 10.1_
  
  - [x] 3.2 Create scenarios API endpoints
    - ✅ Implemented GET /api/scenarios endpoint to list all scenarios with summary info
    - ✅ Implemented GET /api/scenarios/{name} endpoint to get scenario details
    - ✅ Implemented POST /api/scenarios endpoint to create new scenario (201 Created)
    - ✅ Implemented PUT /api/scenarios/{name} endpoint to update scenario
    - ✅ Implemented DELETE /api/scenarios/{name} endpoint to delete scenario
    - ✅ Implemented GET /api/scenarios/templates endpoint for preset templates
    - ✅ Added comprehensive error handling with appropriate HTTP status codes (400, 404, 409, 500)
    - ✅ Created response models (ScenarioSummary, ScenarioDetail, ScenarioCreateResponse, ScenarioUpdateResponse, ScenarioDeleteResponse, TemplateResponse)
    - ✅ Full integration with ScenarioService layer
    - ✅ OpenAPI documentation auto-generated at /docs
    - ✅ Updated backend/README.md with API usage examples
    - _Requirements: 2.1, 2.2, 2.6, 2.7, 9.1, 9.2, 9.3, 9.7_

- [x] 4. Implement Training API and WebSocket ⭐ **COMPLETED**
  - [x] 4.1 Create training service layer ⭐ **COMPLETED**
    - ✅ Implemented training_service.py with HRL training orchestration (535 lines)
    - ✅ Added start_training function that initializes environment and agents
    - ✅ Implemented async training loop with progress tracking
    - ✅ Added stop_training function for graceful termination
    - ✅ Implemented model saving at intervals (checkpoints + final models)
    - ✅ Progress callback mechanism for WebSocket integration
    - ✅ Comprehensive error handling and status tracking
    - ✅ Integration with existing HRL components (BudgetEnv, Agents, HRLTrainer)
    - _Requirements: 3.1, 3.2, 3.6, 3.8, 10.2_
  
  - [x] 4.2 Implement WebSocket for real-time updates ⭐ **COMPLETED**
    - ✅ Created training_socket.py with Socket.IO server setup
    - ✅ Implemented WebSocket connection handler
    - ✅ Added emit_progress function to send TrainingProgress updates
    - ✅ Implemented training event broadcasting (started, progress, completed, stopped, error)
    - ✅ Added connection/disconnection handlers
    - ✅ TrainingSocketManager class for organized event management
    - ✅ Global socket_manager instance for easy access
    - _Requirements: 3.3, 3.4_
  
  - [x] 4.3 Create training API endpoints ⭐ **COMPLETED**
    - ✅ Implemented POST /api/training/start endpoint (202 Accepted)
    - ✅ Implemented POST /api/training/stop endpoint
    - ✅ Implemented GET /api/training/status endpoint (returns TrainingStatus)
    - ✅ Added background task management for training (asyncio)
    - ✅ Integrated WebSocket updates in training loop (every episode)
    - ✅ Comprehensive error handling with appropriate HTTP status codes
    - ✅ Integration with training_service and socket_manager
    - ✅ Updated main.py to mount Socket.IO with FastAPI
    - _Requirements: 3.1, 3.2, 3.6, 3.7, 3.8, 9.2_

- [x] 5. Implement Simulation API ⭐ **COMPLETED**
  - [x] 5.1 Create simulation service layer ⭐ **COMPLETED**
    - ✅ Implemented simulation_service.py with evaluation logic (392 lines)
    - ✅ Added run_simulation function that loads model and scenario
    - ✅ Implemented evaluation loop collecting episode data with deterministic policy
    - ✅ Added _calculate_statistics function for aggregating results
    - ✅ Implemented results saving to JSON files in results/simulations/
    - ✅ Added get_simulation_results function for retrieving saved results
    - ✅ Added list_simulations function for listing all past simulations
    - ✅ Integrated with existing HRL components (BudgetEnv, Agents, Analytics)
    - ✅ Model loading with proper agent initialization
    - ✅ Comprehensive error handling with descriptive messages
    - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 10.3_
  
  - [x] 5.2 Create simulation API endpoints ⭐ **COMPLETED**
    - ✅ Implemented POST /api/simulation/run endpoint (202 Accepted)
    - ✅ Implemented GET /api/simulation/results/{id} endpoint
    - ✅ Implemented GET /api/simulation/history endpoint with SimulationHistoryResponse
    - ✅ Added comprehensive error handling (404, 500)
    - ✅ Integration with simulation_service layer
    - ✅ Response models (SimulationResults, SimulationHistoryResponse)
    - ✅ Proper HTTP status codes and error responses
    - _Requirements: 4.1, 4.2, 4.3, 4.4, 9.2, 9.3_

- [x] 6. Implement Models API ⭐ **COMPLETED**
  - [x] 6.1 Create model service layer ⭐ **COMPLETED**
    - ✅ Implemented model_service.py with model management logic (285 lines)
    - ✅ Added list_models function with metadata extraction
    - ✅ Added get_model function with detailed information
    - ✅ Added delete_model function for model deletion
    - ✅ Implemented _load_metadata and _load_history helper functions
    - ✅ Added _extract_final_metrics for training history processing
    - ✅ Added _process_history for statistical aggregation
    - ✅ Implemented _extract_scenario_name for name inference
    - ✅ NaN/Infinity filtering for robust metrics
    - ✅ Graceful handling of missing metadata/history files
    - _Requirements: 9.2, 10.2, 10.5_
  
  - [x] 6.2 Create models API endpoints ⭐ **COMPLETED**
    - ✅ Implemented GET /api/models endpoint (200, 500)
    - ✅ Implemented GET /api/models/{name} endpoint (200, 404, 500)
    - ✅ Implemented DELETE /api/models/{name} endpoint (200, 404, 500)
    - ✅ Added comprehensive error handling
    - ✅ Integration with model_service layer
    - ✅ Response models (ModelSummary, ModelDetail, ModelListResponse)
    - ✅ Proper HTTP status codes and error responses
    - _Requirements: 9.2, 9.3, 10.2_

- [x] 7. Implement Reports API
  - [x] 7.1 Create report generation service ⭐ **COMPLETED**
    - ✅ Implemented report_service.py with comprehensive report generation (850+ lines)
    - ✅ Added generate_report async function with validation and error handling
    - ✅ Implemented _generate_html_report with professional styled templates
    - ✅ Implemented _generate_pdf_report using WeasyPrint (with HTML fallback)
    - ✅ Added _aggregate_report_data for comprehensive data collection
    - ✅ Implemented _build_html_content with responsive CSS styling
    - ✅ Created section builders: summary, scenario, training, results, strategy, charts
    - ✅ Added get_report, list_reports, get_report_file_path utility functions
    - ✅ Report metadata storage with JSON files
    - ✅ Customizable sections (summary, scenario, training, results, strategy, charts)
    - ✅ Professional HTML templates with print-friendly CSS
    - ✅ Responsive design for web viewing
    - ✅ Strategy visualization with progress bars
    - ✅ Episode data tables with statistics
    - ✅ Global report_service instance for easy access
    - _Requirements: 6.1, 6.2, 6.3, 6.4_
  
  - [x] 7.2 Create reports API endpoints
    - Implement POST /api/reports/generate endpoint
    - Implement GET /api/reports/{id} endpoint for download
    - Implement GET /api/reports/list endpoint
    - Add file serving for generated reports
    - _Requirements: 6.1, 6.2, 6.5, 6.6, 9.2_

- [x] 8. Implement frontend foundation ⭐ **COMPLETED**
  - [x] 8.1 Set up React app structure ⭐ **COMPLETED**
    - ✅ Created App.tsx with React Router setup
    - ✅ Implemented routing for all pages
    - ✅ Created Layout component with navigation
    - ✅ Set up Tailwind CSS configuration
    - ✅ Added ThemeContext provider for light/dark mode
    - _Requirements: 1.1, 8.1, 8.2, 8.6_
  
  - [x] 8.2 Create API client service ⭐ **COMPLETED**
    - ✅ Implemented api.ts with Axios instance
    - ✅ Added functions for all API endpoints
    - ✅ Implemented error handling and retry logic
    - ✅ Added request/response interceptors
    - _Requirements: 9.1, 9.5, 9.7_
  
  - [x] 8.3 Create WebSocket client service ⭐ **COMPLETED**
    - ✅ Implemented websocket.ts with Socket.IO client
    - ✅ Added connection management functions
    - ✅ Implemented event listeners for training updates
    - ✅ Added reconnection logic
    - _Requirements: 3.3, 3.4_
  
  - [x] 8.4 Create TypeScript type definitions ⭐ **COMPLETED**
    - ✅ Created src/types/index.ts with comprehensive type definitions
    - ✅ Defined EnvironmentConfig, TrainingConfig, RewardConfig types
    - ✅ Defined Scenario, ScenarioSummary types
    - ✅ Defined ModelSummary, ModelDetail types
    - ✅ Defined TrainingRequest, TrainingProgress, TrainingStatus types
    - ✅ Defined SimulationRequest, SimulationResult, EpisodeData types
    - ✅ Defined ReportRequest, Report types
    - ✅ All types match backend Pydantic models for full-stack type safety
    - ✅ Updated frontend/README.md with type documentation
    - _Requirements: 9.1, 9.5_

- [x] 9. Implement Dashboard page ⭐ **COMPLETED**
  - ✅ Created Dashboard.tsx component with full functionality (441 lines)
  - ✅ Implemented statistics summary cards (scenarios, models, simulations count)
  - ✅ Added quick action buttons for all major workflows (4 actions)
  - ✅ Implemented recent scenarios section with key metrics display
  - ✅ Implemented recent models section with performance indicators
  - ✅ Added recent activity feed with timeline formatting
  - ✅ Integrated with API service (listScenarios, listModels, getSimulationHistory)
  - ✅ Added loading states with spinner animation
  - ✅ Implemented error handling with retry functionality
  - ✅ Added refresh button for manual data reload
  - ✅ Implemented responsive grid layouts (1/2/3/4 columns)
  - ✅ Added dark mode support throughout
  - ✅ Implemented relative time formatting (minutes/hours/days ago)
  - ✅ Added navigation integration with React Router
  - ✅ Created empty states with call-to-action buttons
  - ✅ Added risk tolerance badges with color coding
  - ✅ Implemented activity icons and type indicators
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_

- [x] 10. Implement Scenario Builder page ⭐ **COMPLETED**
  - [x] 10.1 Create ScenarioBuilder component ⭐ **COMPLETED**
    - ✅ Implemented comprehensive form with all environment parameter inputs (741 lines)
    - ✅ Added form validation with error messages for all required fields
    - ✅ Implemented template selector dropdown with 5 preset templates
    - ✅ Created preview panel showing monthly cash flow, risk profile, and key metrics
    - ✅ Added save and cancel buttons with loading states
    - ✅ Implemented edit mode support via URL query parameters
    - ✅ Added responsive layout with sticky preview panel
    - ✅ Full dark mode support throughout
    - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.8_
  
  - [x] 10.2 Implement form state management ⭐ **COMPLETED**
    - ✅ Used React hooks (useState, useEffect) for form state management
    - ✅ Implemented input change handlers for all form fields
    - ✅ Added comprehensive validation logic for all fields with error display
    - ✅ Implemented template loading from API with auto-population
    - ✅ Added API integration for creating and updating scenarios
    - ✅ Implemented scenario loading for edit mode
    - ✅ Added error handling and loading states
    - _Requirements: 2.2, 2.3, 2.4, 2.6, 2.7_

- [x] 11. Implement Training Monitor page ⭐ **COMPLETED**
  - [x] 11.1 Create TrainingMonitor component ⭐ **COMPLETED**
    - ✅ Implemented comprehensive training configuration form (741 lines)
    - ✅ Added scenario selector dropdown with API integration
    - ✅ Implemented training parameters: episodes, save interval, eval episodes, seed
    - ✅ Added start/stop training buttons with loading states
    - ✅ Created animated progress bar with percentage display
    - ✅ Implemented 6 current metrics display cards (reward, duration, stability, cash, invested, goal adherence)
    - ✅ Added training status indicator with pulsing animation
    - ✅ Implemented WebSocket connection status indicator (green/red dot)
    - ✅ Added elapsed time formatting (hours/minutes/seconds)
    - ✅ Full dark mode support throughout
    - _Requirements: 3.1, 3.2, 3.6, 3.7, 3.8_
  
  - [x] 11.2 Implement real-time chart updates ⭐ **COMPLETED**
    - ✅ Created 4 interactive charts using Recharts library
    - ✅ Implemented WebSocket connection for real-time training updates
    - ✅ Added chart data state management with episode-by-episode tracking
    - ✅ Implemented live chart updates as training progresses
    - ✅ Created Average Reward Over Time chart
    - ✅ Created Average Duration Over Time chart
    - ✅ Created Stability Over Time chart
    - ✅ Created Cash vs Investment Over Time chart (dual-line)
    - ✅ Added responsive chart containers (100% width, 300px height)
    - ✅ Implemented custom tooltips with dark theme styling
    - ✅ Added axis labels and legends for all charts
    - ✅ Implemented training event handlers (started, progress, completed, stopped, error)
    - ✅ Added status polling every 5 seconds as fallback
    - ✅ Conditional rendering: form when idle, charts when training
    - _Requirements: 3.3, 3.4, 3.5_

- [x] 12. Implement Simulation Runner page ⭐ **COMPLETED**
  - [x] 12.1 Create SimulationRunner component ⭐ **COMPLETED**
    - ✅ Implemented comprehensive simulation configuration form (387 lines)
    - ✅ Added model selector dropdown with API integration (shows scenario name)
    - ✅ Added scenario selector dropdown with API integration
    - ✅ Implemented configuration inputs: episodes (1-100), seed (optional)
    - ✅ Added run simulation button with loading states
    - ✅ Implemented animated progress indicator with spinner during simulation
    - ✅ Added "Run Another" reset functionality
    - ✅ Full dark mode support throughout
    - _Requirements: 4.1, 4.2, 4.3, 4.4_
  
  - [x] 12.2 Display summary statistics and results ⭐ **COMPLETED**
    - ✅ Created 4 summary statistics cards (duration, total wealth, investment gains, final portfolio)
    - ✅ Implemented strategy breakdown section with 3 progress bars (invest, save, consume)
    - ✅ Added color-coded investment gains (green for positive, red for negative)
    - ✅ Displayed mean and standard deviation for all metrics
    - ✅ Calculated and displayed investment return percentage
    - ✅ Added simulation metadata display (model, scenario, episodes)
    - ✅ Implemented responsive grid layouts (1/2/4 columns)
    - _Requirements: 4.4, 4.5, 4.6_
  
  - [x] 12.3 Add navigation and actions ⭐ **COMPLETED**
    - ✅ Implemented "View Detailed Results" button with navigation to Results Viewer
    - ✅ Added "Compare Scenarios" button with navigation to Comparison page
    - ✅ Integrated React Router for page navigation
    - ✅ Added error handling with retry capability
    - ✅ Implemented loading states for all async operations
    - _Requirements: 4.1, 4.6_

- [ ] 13. Implement Results Viewer page
  - [ ] 13.1 Create ResultsViewer component
    - Implement summary statistics cards
    - Add tab navigation for different chart views
    - Create strategy learned display section
    - Add action buttons for compare, report, export
    - _Requirements: 5.1, 5.4, 5.5_
  
  - [ ] 13.2 Implement interactive charts
    - Create cash balance over time chart with Recharts
    - Create portfolio evolution chart
    - Create wealth accumulation chart
    - Create action distribution pie chart
    - Add tooltips on hover for all charts
    - Implement zoom and pan functionality
    - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.6, 5.7, 5.8_

- [ ] 14. Implement Comparison view
  - Create Comparison.tsx component
  - Implement scenario selector for multiple scenarios
  - Create side-by-side metrics comparison table
  - Implement comparative charts
  - Add difference highlighting
  - Implement export to CSV/JSON functionality
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_

- [ ] 15. Implement Report Generation
  - Create ReportModal component
  - Implement report configuration form
  - Add report type selector (PDF/HTML)
  - Implement section customization checkboxes
  - Add generate button with API integration
  - Implement download link when report is ready
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_

- [ ] 16. Implement responsive design and accessibility
  - Add responsive breakpoints for all components
  - Implement mobile-friendly navigation menu
  - Add keyboard navigation support
  - Implement ARIA labels for all interactive elements
  - Test and fix color contrast issues
  - Add focus indicators for all focusable elements
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6_

- [ ] 17. Add error handling and loading states
  - Implement toast notification system
  - Add loading spinners for async operations
  - Create error boundary components
  - Add retry mechanisms for failed API calls
  - Implement graceful degradation for missing data
  - Add error logging
  - _Requirements: 9.7_

- [ ] 18. Create API documentation
  - Set up Swagger/OpenAPI documentation
  - Add endpoint descriptions and examples
  - Document request/response schemas
  - Add authentication documentation (if implemented)
  - Create API usage examples
  - _Requirements: 9.6_

- [ ] 19. Write tests
  - [ ] 19.1 Backend tests
    - Write unit tests for API endpoints
    - Write unit tests for service layer
    - Write integration tests for complete workflows
    - Write tests for WebSocket communication
    - _Requirements: All backend requirements_
  
  - [ ] 19.2 Frontend tests
    - Write component tests for all major components
    - Write tests for form validation
    - Write tests for API integration
    - Write E2E tests for critical user flows
    - _Requirements: All frontend requirements_

- [ ] 20. Create deployment configuration
  - Create Dockerfile for containerized deployment
  - Create docker-compose.yml for local development
  - Add environment variable configuration
  - Create production build scripts
  - Add deployment documentation
  - _Requirements: All requirements_

- [ ] 21. Create user documentation
  - Write README.md with setup instructions
  - Create user guide for all features
  - Add screenshots and GIFs for key workflows
  - Document API usage examples
  - Create troubleshooting guide
  - _Requirements: All requirements_
